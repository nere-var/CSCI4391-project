{% extends '0-MainPageSetup.html' %}

<!--
{% block head %}
<title>Food Inventory</title>
<link rel="stylesheet" href="{{ url_for('static', filename='css/homestyle.css') }}">
{% endblock %}
-->

{% block body %}
<div class="welcome1">
    <h1>Food Inventory</h1>
</div>

<div class="body">
    <!-- =================================== current player stats ================================== -->
    <p class="text">Player: <strong>{{ current_player.name }}</strong></p>
    <p class="text">Score: <strong>{{ current_player.score }}</strong></p>
    <a href="{{ url_for('add_item_page', player_id=current_player.id) }}" class="text">Add New Item</a>
    <!-- =========================================================================================== -->
</div>

<div class="body">
    <div class="table-container">
        <!-- =================== Table Setup =================== -->
        <table class="kawaii-table" id="inventoryTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                    <th>Measurement Type</th>
                    <th>Ggrams</th>
                    <th>ML</th>
                    <th>Date Purchased</th>
                    <th>Best By</th>
                    <th>Raw</th>
                    <th>Perishable</th>
                    <th>Opened</th>
                    <th>Donation Allowed</th>
                    <th>Decomposition Flag</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td data-label="Name:">{{ item.name }}</td>
                    <td data-label="Category:">{{ item.category }}</td>
                    <td data-label="Quantity:">{{ item.quantity }}</td>
                    <td data-label="Unit:">{{ item.unit }}</td>
                    <td data-label="Measurement:">{{ item.measurement_type }}</td>
                    <td data-label="Grams:">{{ item.quantity_grams }}</td>
                    <td data-label="mL:">{{ item.quantity_ml }}</td>
                    <td data-label="Purchase Date:">{{ item.purchase_date }}</td>
                    <td data-label="Best By Date:">{{ item.best_by }}</td>
                    <td data-label="Raw Meat:">{{ item.raw_meat }}</td>
                    <td data-label="Perishable:">{{ item.perishable }}</td>
                    <td data-label="Opened:">{{ item.opened }}</td>
                    <td data-label="Donation Allowed:">{{ item.donation_allowed }}</td>
                    <td data-label="Decomposed:">{{ item.decomposition_flag }}</td>
                    <td data-label="Price:">{{ item.price }}</td>
                    <td data-label="Status:">{{ item.status }}</td>
                    <td>

                        <!-- ==========================================================  Status Check ========================================================== -->
                        <!-- =================== 
                             Active Status Check 
                             =================== -->
                        {% if item.status == 'active' %}
                            <form action="{{ url_for('use_item', item_id=item.id, player_id=current_player.id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="kawaii-lil-btn">Use</button>
                            </form>

                            <form action="{{ url_for('donate_item', item_id=item.id, player_id=current_player.id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="kawaii-lil-btn">Donate</button>
                            </form>

                            <form action="{{ url_for('compost_item', item_id=item.id, player_id=current_player.id) }}" method="POST" style="display:inline;">
                                <button type="submit" class="kawaii-lil-btn">Compost</button>
                            </form>
                        {% endif %}

                        <!-- ==================== 
                             Compost Status Check 
                             ==================== -->
                        {% if item.status == 'composted' %}
                            <form action="{{ url_for('delete_item', item_id=item.id, player_id=current_player.id) }}" method="POST" style="display:inline;">
                                <button type="submit">Delete</button>
                            </form>
                        {% endif %}

                        <!-- =================== 
                             Donate Status Check 
                             =================== -->
                        {% if item.status == 'donated' %}
                            <form action="{{ url_for('delete_item', item_id=item.id, player_id=current_player.id) }}" method="POST" style="display:inline;">
                                <button type="submit">Delete</button>
                            </form>
                        {% endif %}
                        <!-- =================================================================================================================================== -->
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>


    <!-- ====================================== -->
    <br /><br />
    <div class="images">
        <a href="javascript:history.back()">
            <img src="{{ url_for('static', filename='Pictures/BinnyBack.png') }}" alt="bot" class="binnybot">
        </a>
        <a href="/">
            <img src="{{ url_for('static', filename='Pictures/BinnyHome.png') }}" alt="homebot" class="binnyhome">
        </a>
    </div>
</div>


<!-- ========================
     Sort List By Oldest Item
     ======================== -->

<script>
document.addEventListener("DOMContentLoaded", function () {
    const table = document.getElementById("inventoryTable");
    const tbody = table.querySelector("tbody");
    const rows = Array.from(tbody.querySelectorAll("tr"));

    rows.sort(function (a, b) {
        const aText = a.children[3].innerText.trim();
        const bText = b.children[3].innerText.trim();
        const aDate = new Date(aText);
        const bDate = new Date(bText);
        return aDate - bDate;
    });

    rows.forEach(row => tbody.appendChild(row));
});
</script>


<!-- ========================
     Chatbot for rn 
     ======================== -->

<!-- change into chatbox later  -->
<center class="row">
    <form method="post" class="col-md-6 col-md-offset-3">
        <div class="kawaii-table">
            <h3>Type in Here =p:</h3>
            <input type="text" class="kawaii-login input" name="message" placeholder="text Here !!">
            <div class="input-Chatgroup-btn">
                <button class="kawaii-btn" type="submit">
                 submit
                </button>
            </div>
        </div>
    </form>  
    {% if Response %}
<div class="kawaii-table">
    <h3>BinnyBot:</h3>
<!--    <p>{{ Response }}</p> -->
    <pre class="kawaii-ai-response">{{ Response }}</pre>
</div>
{% endif %}
</center>




{% endblock %}






